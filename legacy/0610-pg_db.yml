#==============================================================#
# 0610 pg_db
#==============================================================#
pg_db_92:
  name: pg_db
  desc: PostgreSQL database stats from pg_stat_database (9.2 - 9.6)
  query: |-
    SELECT d.datname, datid,age(datfrozenxid) AS age, datistemplate AS is_template, datallowconn AS allow_conn, datconnlimit AS conn_limit, datfrozenxid::TEXT::BIGINT as frozen_xid,
      numbackends,xact_commit,xact_rollback,xact_rollback + xact_commit AS xact_total, blks_read,blks_hit,blks_read + blks_hit AS blks_access,tup_returned,tup_fetched,tup_inserted,tup_updated,tup_deleted,tup_inserted + tup_updated + tup_deleted AS tup_modified,
      conflicts,temp_files,temp_bytes,deadlocks,blk_read_time,blk_write_time, extract(EPOCH FROM stats_reset) AS reset_time
    FROM pg_database d JOIN pg_stat_database sd ON d.oid = sd.datid;
  ttl: 10
  min_version: 90200
  max_version: 100000
  tags: [ cluster ]
  metrics:
    - datname:             { usage: LABEL   ,description: Name of the database }
    - datid:               { usage: GAUGE   ,description: OID of the database }
    - age:                 { usage: GAUGE   ,description: Age of database calculated from datfrozenxid }
    - is_template:         { usage: GAUGE   ,description: If true(1), then this database can be cloned by any user with CREATEDB privileges }
    - allow_conn:          { usage: GAUGE   ,description: If false(0) then no one can connect to this database. }
    - conn_limit:          { usage: GAUGE   ,description: Sets maximum number of concurrent connections that can be made to this database. -1 means no limit. }
    - frozen_xid:          { usage: GAUGE   ,description: All transaction IDs before this one have been frozen }
    - numbackends:         { usage: GAUGE   ,description: Number of backends currently connected to this database }
    - xact_commit:         { usage: COUNTER ,description: Number of transactions in this database that have been committed }
    - xact_rollback:       { usage: COUNTER ,description: Number of transactions in this database that have been rolled back }
    - xact_total:          { usage: COUNTER ,description: Number of transactions in this database }
    - blks_read:           { usage: COUNTER ,description: Number of disk blocks read in this database }
    - blks_hit:            { usage: COUNTER ,description: Number of times disk blocks were found already in the buffer cache }
    - blks_access:         { usage: COUNTER ,description: Number of times disk blocks that accessed read+hit }
    - tup_returned:        { usage: COUNTER ,description: Number of rows returned by queries in this database }
    - tup_fetched:         { usage: COUNTER ,description: Number of rows fetched by queries in this database }
    - tup_inserted:        { usage: COUNTER ,description: Number of rows inserted by queries in this database }
    - tup_updated:         { usage: COUNTER ,description: Number of rows updated by queries in this database }
    - tup_deleted:         { usage: COUNTER ,description: Number of rows deleted by queries in this database }
    - tup_modified:        { usage: COUNTER ,description: Number of rows modified by queries in this database }
    - conflicts:           { usage: COUNTER ,description: Number of queries canceled due to conflicts with recovery in this database }
    - temp_files:          { usage: COUNTER ,description: Number of temporary files created by queries in this database }
    - temp_bytes:          { usage: COUNTER ,description: Total amount of data written to temporary files by queries in this database. }
    - deadlocks:           { usage: COUNTER ,description: Number of deadlocks detected in this database }
    - blk_read_time:       { usage: COUNTER ,scale: 1e-3 ,description: Time spent reading data file blocks by backends in this database, in seconds }
    - blk_write_time:      { usage: COUNTER ,scale: 1e-3 ,description: Time spent writing data file blocks by backends in this database, in seconds }
    - reset_time:          { usage: GAUGE   ,description: Time at which database statistics were last reset }

pg_db_91:
  name: pg_db
  desc: PostgreSQL database stats from pg_stat_database (9.1, fewer columns)
  query: |-
    SELECT d.datname, datid,age(datfrozenxid) AS age, datistemplate AS is_template, datallowconn AS allow_conn, datconnlimit AS conn_limit, datfrozenxid::TEXT::BIGINT as frozen_xid,
      numbackends,xact_commit,xact_rollback,xact_rollback + xact_commit AS xact_total, blks_read,blks_hit,blks_read + blks_hit AS blks_access,tup_returned,tup_fetched,tup_inserted,tup_updated,tup_deleted,tup_inserted + tup_updated + tup_deleted AS tup_modified,
      conflicts, 0::BIGINT AS temp_files, 0::BIGINT AS temp_bytes, 0::BIGINT AS deadlocks, 0::BIGINT AS blk_read_time, 0::BIGINT AS blk_write_time,
      extract(EPOCH FROM stats_reset) AS reset_time
    FROM pg_database d JOIN pg_stat_database sd ON d.oid = sd.datid;
  ttl: 10
  min_version: 90100
  max_version: 90200
  tags: [ cluster ]
  metrics:
    - datname:             { usage: LABEL   ,description: Name of the database }
    - datid:               { usage: GAUGE   ,description: OID of the database }
    - age:                 { usage: GAUGE   ,description: Age of database calculated from datfrozenxid }
    - is_template:         { usage: GAUGE   ,description: If true(1), then this database can be cloned by any user with CREATEDB privileges }
    - allow_conn:          { usage: GAUGE   ,description: If false(0) then no one can connect to this database. }
    - conn_limit:          { usage: GAUGE   ,description: Sets maximum number of concurrent connections that can be made to this database. -1 means no limit. }
    - frozen_xid:          { usage: GAUGE   ,description: All transaction IDs before this one have been frozen }
    - numbackends:         { usage: GAUGE   ,description: Number of backends currently connected to this database }
    - xact_commit:         { usage: COUNTER ,description: Number of transactions in this database that have been committed }
    - xact_rollback:       { usage: COUNTER ,description: Number of transactions in this database that have been rolled back }
    - xact_total:          { usage: COUNTER ,description: Number of transactions in this database }
    - blks_read:           { usage: COUNTER ,description: Number of disk blocks read in this database }
    - blks_hit:            { usage: COUNTER ,description: Number of times disk blocks were found already in the buffer cache }
    - blks_access:         { usage: COUNTER ,description: Number of times disk blocks that accessed read+hit }
    - tup_returned:        { usage: COUNTER ,description: Number of rows returned by queries in this database }
    - tup_fetched:         { usage: COUNTER ,description: Number of rows fetched by queries in this database }
    - tup_inserted:        { usage: COUNTER ,description: Number of rows inserted by queries in this database }
    - tup_updated:         { usage: COUNTER ,description: Number of rows updated by queries in this database }
    - tup_deleted:         { usage: COUNTER ,description: Number of rows deleted by queries in this database }
    - tup_modified:        { usage: COUNTER ,description: Number of rows modified by queries in this database }
    - conflicts:           { usage: COUNTER ,description: Number of queries canceled due to conflicts with recovery in this database }
    - temp_files:          { usage: COUNTER ,description: Number of temporary files created by queries in this database (N/A on 9.1, always 0) }
    - temp_bytes:          { usage: COUNTER ,description: Total amount of data written to temporary files by queries in this database (N/A on 9.1, always 0) }
    - deadlocks:           { usage: COUNTER ,description: Number of deadlocks detected in this database (N/A on 9.1, always 0) }
    - blk_read_time:       { usage: COUNTER ,scale: 1e-3 ,description: Time spent reading data file blocks by backends in this database, in seconds (N/A on 9.1, always 0) }
    - blk_write_time:      { usage: COUNTER ,scale: 1e-3 ,description: Time spent writing data file blocks by backends in this database, in seconds (N/A on 9.1, always 0) }
    - reset_time:          { usage: GAUGE   ,description: Time at which database statistics were last reset }

pg_db_90:
  name: pg_db
  desc: PostgreSQL database stats from pg_stat_database (9.0, no conflicts)
  query: |-
    SELECT d.datname, datid,age(datfrozenxid) AS age, datistemplate AS is_template, datallowconn AS allow_conn, datconnlimit AS conn_limit, datfrozenxid::TEXT::BIGINT as frozen_xid,
      numbackends,xact_commit,xact_rollback,xact_rollback + xact_commit AS xact_total, blks_read,blks_hit,blks_read + blks_hit AS blks_access,tup_returned,tup_fetched,tup_inserted,tup_updated,tup_deleted,tup_inserted + tup_updated + tup_deleted AS tup_modified,
      0::BIGINT AS conflicts, 0::BIGINT AS temp_files, 0::BIGINT AS temp_bytes, 0::BIGINT AS deadlocks, 0::BIGINT AS blk_read_time, 0::BIGINT AS blk_write_time,
      extract(EPOCH FROM stats_reset) AS reset_time
    FROM pg_database d JOIN pg_stat_database sd ON d.oid = sd.datid;
  ttl: 10
  min_version: 90000
  max_version: 90100
  tags: [ cluster ]
  metrics:
    - datname:             { usage: LABEL   ,description: Name of the database }
    - datid:               { usage: GAUGE   ,description: OID of the database }
    - age:                 { usage: GAUGE   ,description: Age of database calculated from datfrozenxid }
    - is_template:         { usage: GAUGE   ,description: If true(1), then this database can be cloned by any user with CREATEDB privileges }
    - allow_conn:          { usage: GAUGE   ,description: If false(0) then no one can connect to this database. }
    - conn_limit:          { usage: GAUGE   ,description: Sets maximum number of concurrent connections that can be made to this database. -1 means no limit. }
    - frozen_xid:          { usage: GAUGE   ,description: All transaction IDs before this one have been frozen }
    - numbackends:         { usage: GAUGE   ,description: Number of backends currently connected to this database }
    - xact_commit:         { usage: COUNTER ,description: Number of transactions in this database that have been committed }
    - xact_rollback:       { usage: COUNTER ,description: Number of transactions in this database that have been rolled back }
    - xact_total:          { usage: COUNTER ,description: Number of transactions in this database }
    - blks_read:           { usage: COUNTER ,description: Number of disk blocks read in this database }
    - blks_hit:            { usage: COUNTER ,description: Number of times disk blocks were found already in the buffer cache }
    - blks_access:         { usage: COUNTER ,description: Number of times disk blocks that accessed read+hit }
    - tup_returned:        { usage: COUNTER ,description: Number of rows returned by queries in this database }
    - tup_fetched:         { usage: COUNTER ,description: Number of rows fetched by queries in this database }
    - tup_inserted:        { usage: COUNTER ,description: Number of rows inserted by queries in this database }
    - tup_updated:         { usage: COUNTER ,description: Number of rows updated by queries in this database }
    - tup_deleted:         { usage: COUNTER ,description: Number of rows deleted by queries in this database }
    - tup_modified:        { usage: COUNTER ,description: Number of rows modified by queries in this database }
    - conflicts:           { usage: COUNTER ,description: Number of queries canceled due to conflicts with recovery in this database (N/A on 9.0, always 0) }
    - temp_files:          { usage: COUNTER ,description: Number of temporary files created by queries in this database (N/A on 9.0, always 0) }
    - temp_bytes:          { usage: COUNTER ,description: Total amount of data written to temporary files by queries in this database (N/A on 9.0, always 0) }
    - deadlocks:           { usage: COUNTER ,description: Number of deadlocks detected in this database (N/A on 9.0, always 0) }
    - blk_read_time:       { usage: COUNTER ,scale: 1e-3 ,description: Time spent reading data file blocks by backends in this database, in seconds (N/A on 9.0, always 0) }
    - blk_write_time:      { usage: COUNTER ,scale: 1e-3 ,description: Time spent writing data file blocks by backends in this database, in seconds (N/A on 9.0, always 0) }
    - reset_time:          { usage: GAUGE   ,description: Time at which database statistics were last reset }

